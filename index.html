<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Живая Земля | Интерактив</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&display=swap');

        body {
            margin: 0;
            overflow: hidden;
            background-color: #000;
            font-family: 'Rajdhani', sans-serif;
            color: white;
        }

        #canvas-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .text-glow {
            text-shadow: 0 0 10px rgba(100, 200, 255, 0.8), 0 0 20px rgba(100, 200, 255, 0.4);
        }

        .ui-layer {
            position: relative;
            z-index: 10;
            pointer-events: none; /* Let clicks pass through to canvas where needed, re-enable on children */
        }

        .interactive-element {
            pointer-events: auto;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .interactive-element:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(50, 150, 255, 0.6);
        }

        /* Custom scrollbar hidden */
        ::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }
        
        .glitch-effect {
            animation: glitch 1s linear infinite;
        }

        @keyframes glitch {
            2%, 64% { transform: translate(2px,0) skew(0deg); }
            4%, 60% { transform: translate(-2px,0) skew(0deg); }
            62% { transform: translate(0,0) skew(5deg); }
        }

        /* Continuous floating animation for UI */
        .floating {
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        #cursor-follower {
            position: absolute;
            width: 20px;
            height: 20px;
            border: 1px solid cyan;
            border-radius: 50%;
            pointer-events: none;
            z-index: 9999;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 10px cyan;
            transition: width 0.2s, height 0.2s;
        }
    </style>
</head>
<body>

    <div id="cursor-follower"></div>

    <!-- 3D Container -->
    <div id="canvas-container"></div>

    <!-- UI Overlay -->
    <div class="ui-layer w-full h-screen flex flex-col justify-between p-8">
        
        <!-- Header -->
        <header class="flex justify-between items-center">
            <div class="interactive-element glass-panel px-6 py-2 rounded-full">
                <h1 class="font-['Orbitron'] text-2xl font-bold text-cyan-400 tracking-widest">TERRA <span class="text-white">NOVA</span></h1>
            </div>
            <div class="interactive-element glass-panel px-4 py-2 rounded-full flex gap-4 text-sm font-bold tracking-wider">
                <span class="text-cyan-300">СТАТУС: <span class="text-white animate-pulse">ОНЛАЙН</span></span>
                <span class="text-cyan-300">ВРАЩЕНИЕ: <span id="speed-indicator" class="text-white">НОРМА</span></span>
            </div>
        </header>

        <!-- Main Content Left -->
        <div class="flex h-full items-center">
            <div class="max-w-lg floating">
                <h2 id="main-title" class="font-['Orbitron'] text-7xl font-black leading-none mb-4 transform -translate-x-20 opacity-0 text-glow">
                    ПЛАНЕТА<br>
                    <span class="text-transparent bg-clip-text bg-linear-to-r from-cyan-400 to-blue-600">В ДВИЖЕНИИ</span>
                </h2>
                <p id="main-desc" class="text-xl text-gray-300 mb-8 transform translate-y-10 opacity-0 bg-black/30 p-4 rounded-r-xl border-l-4 border-cyan-500">
                    Исследуйте мир, который никогда не стоит на месте. Взаимодействуйте с цифровой копией Земли в реальном времени. Крутите, ускоряйте, наблюдайте.
                </p>
                
                <div class="flex gap-4 transform translate-y-10 opacity-0" id="btn-group">
                    <button id="btn-warp" class="interactive-element bg-cyan-600 hover:bg-cyan-500 text-black font-bold py-3 px-8 rounded-sm font-['Orbitron'] clip-path-polygon">
                        ГИПЕР-СКОРОСТЬ
                    </button>
                    <button id="btn-reset" class="interactive-element glass-panel hover:bg-white/10 text-white font-bold py-3 px-8 rounded-sm font-['Orbitron'] border border-cyan-500/50">
                        СБРОС
                    </button>
                </div>
            </div>
        </div>

        <!-- Footer Data -->
        <footer class="flex justify-between items-end">
            <div class="glass-panel p-4 rounded-lg max-w-xs interactive-element transform translate-y-20 opacity-0" id="stats-card">
                <h3 class="text-cyan-400 font-bold mb-2 border-b border-white/20 pb-1">ТЕЛЕМЕТРИЯ</h3>
                <div class="grid grid-cols-2 gap-4 text-sm">
                    <div>
                        <p class="text-gray-400 text-xs">СКОРОСТЬ</p>
                        <p class="text-xl font-mono" id="stat-speed">107,000 км/ч</p>
                    </div>
                    <div>
                        <p class="text-gray-400 text-xs">НАСЕЛЕНИЕ</p>
                        <p class="text-xl font-mono">8.1 МЛРД</p>
                    </div>
                </div>
            </div>
            
            <div class="text-right opacity-50 hover:opacity-100 transition-opacity">
                <p class="text-xs tracking-[0.3em]">КООРДИНАТЫ СИСТЕМЫ</p>
                <p class="font-mono text-lg text-cyan-300" id="coords">00.0000 N, 00.0000 E</p>
            </div>
        </footer>
    </div>

    <script>
        // --- 1. THREE.JS SETUP ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 2.5; // Closer camera for dramatic effect

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        // --- 2. LIGHTING ---
        const ambientLight = new THREE.AmbientLight(0x333333);
        scene.add(ambientLight);

        const sunLight = new THREE.DirectionalLight(0xffffff, 1.5);
        sunLight.position.set(5, 3, 5);
        scene.add(sunLight);

        const pointLight = new THREE.PointLight(0x00bcff, 1, 10); // Blue glow light
        pointLight.position.set(-2, 1, 2);
        scene.add(pointLight);

        // --- 3. EARTH GROUP ---
        const earthGroup = new THREE.Group();
        scene.add(earthGroup);
        // Tilt the earth slightly
        earthGroup.rotation.z = 23.5 * Math.PI / 180;

        // Texture Loader
        const textureLoader = new THREE.TextureLoader();
        
        // Fallback colors if textures fail, but using standard GH raw URLs
        const textureURL = 'https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/planets/earth_atmos_2048.jpg';
        const specularURL = 'https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/planets/earth_specular_2048.jpg';
        const cloudURL = 'https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/planets/earth_clouds_1024.png';

        // EARTH SPHERE
        const geometry = new THREE.SphereGeometry(0.6, 64, 64);
        const material = new THREE.MeshPhongMaterial({
            map: textureLoader.load(textureURL),
            specularMap: textureLoader.load(specularURL),
            specular: new THREE.Color('grey'),
            shininess: 10
        });
        const earth = new THREE.Mesh(geometry, material);
        earthGroup.add(earth);

        // CLOUDS SPHERE (slightly larger)
        const cloudGeometry = new THREE.SphereGeometry(0.61, 64, 64);
        const cloudMaterial = new THREE.MeshPhongMaterial({
            map: textureLoader.load(cloudURL),
            transparent: true,
            opacity: 0.8,
            blending: THREE.AdditiveBlending,
            side: THREE.DoubleSide
        });
        const clouds = new THREE.Mesh(cloudGeometry, cloudMaterial);
        earthGroup.add(clouds);

        // ATMOSPHERE GLOW (Shader-like effect using sprites or just a larger mesh back-side)
        const atmosGeometry = new THREE.SphereGeometry(0.63, 64, 64);
        const atmosMaterial = new THREE.MeshPhongMaterial({
            color: 0x0099ff,
            transparent: true,
            opacity: 0.15,
            side: THREE.BackSide,
            blending: THREE.AdditiveBlending
        });
        const atmosphere = new THREE.Mesh(atmosGeometry, atmosMaterial);
        earthGroup.add(atmosphere);

        // --- 4. STARFIELD (MOVING) ---
        const starsGeometry = new THREE.BufferGeometry();
        const starsCount = 3000;
        const posArray = new Float32Array(starsCount * 3);
        
        for(let i = 0; i < starsCount * 3; i++) {
            posArray[i] = (Math.random() - 0.5) * 10; // Spread stars
        }
        
        starsGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
        const starsMaterial = new THREE.PointsMaterial({
            size: 0.005,
            color: 0xffffff,
            transparent: true,
            opacity: 0.8,
            blending: THREE.AdditiveBlending
        });
        const stars = new THREE.Points(starsGeometry, starsMaterial);
        scene.add(stars);


        // --- 5. ANIMATION VARIABLES & INTERACTIVITY ---
        let mouseX = 0;
        let mouseY = 0;
        const windowHalfX = window.innerWidth / 2;
        const windowHalfY = window.innerHeight / 2;
        let rotationSpeed = 0.001;
        let baseRotationSpeed = 0.001;
        let warpSpeed = false;

        // Drag Variables
        let isDragging = false;
        let previousMousePosition = { x: 0, y: 0 };
        let targetRotationX = 0;
        let targetRotationY = 0;
        
        // Mouse Move (General)
        document.addEventListener('mousemove', (event) => {
            mouseX = (event.clientX - windowHalfX);
            mouseY = (event.clientY - windowHalfY);
            
            // Update coordinates text
            const lat = ((event.clientY / window.innerHeight) * 180 - 90).toFixed(4);
            const long = ((event.clientX / window.innerWidth) * 360 - 180).toFixed(4);
            document.getElementById('coords').innerText = `${Math.abs(lat)} ${lat > 0 ? 'N' : 'S'}, ${Math.abs(long)} ${long > 0 ? 'E' : 'W'}`;
        });

        // Drag Events
        const container = document.getElementById('canvas-container');
        
        container.addEventListener('mousedown', (e) => {
            isDragging = true;
            previousMousePosition = { x: e.clientX, y: e.clientY };
            container.style.cursor = 'grabbing';
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
            container.style.cursor = 'grab';
        });

        document.addEventListener('mousemove', (e) => {
            if (isDragging) {
                const deltaMove = {
                    x: e.clientX - previousMousePosition.x,
                    y: e.clientY - previousMousePosition.y
                };

                // Rotate the earth group based on drag
                // We add to target rotation to accumulate spin
                targetRotationY += deltaMove.x * 0.005;
                targetRotationX += deltaMove.y * 0.005;

                previousMousePosition = { x: e.clientX, y: e.clientY };
            }
        });
        
        // Set initial cursor
        container.style.cursor = 'grab';

        // Buttons
        document.getElementById('btn-warp').addEventListener('click', () => {
            warpSpeed = true;
            gsap.to(camera.position, { z: 1.5, duration: 2, ease: "power2.inOut" });
            document.getElementById('speed-indicator').innerText = "ГИПЕР";
            document.getElementById('speed-indicator').classList.add('text-red-500');
        });

        document.getElementById('btn-reset').addEventListener('click', () => {
            warpSpeed = false;
            gsap.to(camera.position, { z: 2.5, duration: 2, ease: "power2.inOut" });
            document.getElementById('speed-indicator').innerText = "НОРМА";
            document.getElementById('speed-indicator').classList.remove('text-red-500');
            // Reset rotation orientation
            targetRotationX = 0;
            targetRotationY = 0;
        });


        // --- 6. ANIMATION LOOP ---
        const clock = new THREE.Clock();

        function animate() {
            requestAnimationFrame(animate);
            const elapsedTime = clock.getElapsedTime();

            // 1. Rotate Earth & Clouds (The "Spin" of the planet itself)
            let currentSpeed = warpSpeed ? 0.05 : baseRotationSpeed;
            earth.rotation.y += currentSpeed;
            clouds.rotation.y += currentSpeed * 1.2;
            clouds.rotation.x += 0.0001; 

            // 2. Automatic Drift (Side to Side)
            const driftX = Math.sin(elapsedTime * 0.5) * 0.5; 
            const driftY = Math.cos(elapsedTime * 0.3) * 0.2;

            // 3. Apply Rotation Logic
            // Combine: Manual Drag (targetRotation) + Automatic "Look" influence (optional)
            
            // Smoothly interpolate current rotation to target rotation (Drag momentum effect)
            // We use a lerp factor. If not dragging, we might want it to settle or keep spinning?
            // For now, we just lerp to the dragged position.
            
            earthGroup.rotation.y += 0.1 * (targetRotationY - earthGroup.rotation.y);
            earthGroup.rotation.x += 0.1 * (targetRotationX - earthGroup.rotation.x);

            // If user is NOT dragging, we can add a little bit of auto-sway to the rotation too
            // so it feels alive even when static
            if(!isDragging) {
                earthGroup.rotation.y += Math.sin(elapsedTime * 0.2) * 0.001;
                earthGroup.rotation.x += Math.cos(elapsedTime * 0.3) * 0.001;
            }

            // Move the whole group physically (The "driving around" part)
            earthGroup.position.x = driftX * 0.5; 
            earthGroup.position.y = driftY * 0.2;

            // 4. Parallax Stars
            stars.rotation.y = -mouseX * 0.0002;
            stars.rotation.x = -mouseY * 0.0002;

            // 5. Update Stat
            if(warpSpeed) {
                 document.getElementById('stat-speed').innerText = (Math.random() * 500000 + 100000).toFixed(0) + " км/ч";
            } else {
                 document.getElementById('stat-speed').innerText = "107,000 км/ч";
            }

            renderer.render(scene, camera);
        }

        animate();

        // --- 7. GSAP UI ANIMATIONS ---
        // Intro animations
        const tl = gsap.timeline();

        tl.to("#main-title", { 
            duration: 1.5, 
            x: 0, 
            opacity: 1, 
            ease: "power3.out",
            stagger: 0.2
        })
        .to("#main-desc", {
            duration: 1,
            y: 0,
            opacity: 1,
            ease: "back.out(1.7)"
        }, "-=1")
        .to("#btn-group", {
            duration: 1,
            y: 0,
            opacity: 1,
            ease: "power2.out"
        }, "-=0.5")
        .to("#stats-card", {
            duration: 1,
            y: 0,
            opacity: 1,
            ease: "power2.out"
        }, "-=0.8");

        // Resize Handler
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // --- 8. CURSOR FOLLOWER LOGIC ---
        const follower = document.getElementById('cursor-follower');
        let followerX = 0, followerY = 0;
        
        document.addEventListener('mousemove', (e) => {
            gsap.to(follower, {
                duration: 0.5,
                x: e.clientX,
                y: e.clientY,
                ease: "power2.out"
            });
        });

        // --- 9. DATA SCRAMBLER ---
        const populationEl = document.querySelector('#stats-card .text-xl.font-mono:last-child');
        let basePop = 8100000000;
        
        setInterval(() => {
            // Simulate births/deaths rapidly
            const change = Math.floor(Math.random() * 10) - 3; 
            basePop += change;
            // Format nicely
            const formatted = (basePop / 1000000000).toFixed(9) + " МЛРД";
            populationEl.innerText = formatted;
        }, 100);

    </script>
</body>
</html>
